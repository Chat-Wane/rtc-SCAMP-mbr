<html>
  <head> <title>SCAMPjs</title> </head>
  <body>
    <textarea rows="5" cols="80" id="textID"></textarea> <br/>
    <button type="button" id="offer">1. Make offer</button>
    <button type="button" id="join">2. Accept offer</button>
    <button type="button" id="handshake">3. Confirm handshake</button>
    <br/>  <!-- ugly but whatever, just an example -->
    <br/>
    <br/>
    <div id="log"></div>

    <script src="./jquery-2.1.1.min.js"></script>
    <script src="../scampjs.bundle.js"></script>
    <script>
      var Peer = require('scampjs');
      var p = new Peer(Math.floor(Math.random()*1000));

      $("#offer").click(function(){p.initiate()});
      $("#join").click(function(){
      var message = JSON.parse($("#textID").val());
      p.onContact(message.uid, message.counter, message.offer);
      });
      $("#handshake").click(function(){
      var message = JSON.parse($("#textID").val());
      p.acceptContact(message.uid, message.destCounter, message.offer);
      });

      setInterval( function(){
       p.broadcast("hello my name is "+ p.track.local.e);
      }, Math.floor(Math.random()*5000)+15000 );

      
      p.on("first", function(message){
        $("#textID").val(JSON.stringify(message));
      });
      
      p.on("contact", function(message){
        $("#textID").val(JSON.stringify(message));
      });

      p.on("receive", function(message){
        $("#log").html( $("#log").html() + message + "<br/>" );
      });
      
    </script>
  </body>
</html>
